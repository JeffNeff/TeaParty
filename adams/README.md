# adams

TeaParty's Interface and Orchestration.

## Interacting with the `adams`
`adams` serves on port: `8080` for API and Cloudevent requests 

## API Routes 


### /sell
`/sell` provides an interface for creating new sell requests. It expects an HTTP Post request containing the following JSON schema:


| Key      | Description | 
| ----------- | ----------- |
| currency      | The asset the seller wishes to post for trade       |
| amount   | The quantity of `currency` the seller wishes to trade        |
| tradeAsset   |   The asset the seller wishes to obtain       |
| price   | Te quantity of `tradeAsset` the seller wishes to obtain        |
| sellerShippingAddress   | An address on the `tradeAsset` network that the seller wishes to recieve payment on   |
| paymentTransactionID   | The Transaction ID proving that 1 MO has been burnt into the `paygate` contract.    |
| sellerNKNAddress   | The public NKN address the seller's `tea` client is listening on. (Generated by `tea`)      |
| txid   | A Transaction ID for the order (Generated by `tea`)       |


Example curl request:
```cmd 
curl -v "http://0.0.0.0:8081/sell" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"grams","amount": 10000 ,"tradeAsset":"octa","price":10000,  "txid":"32123122322121212", "sellerShippingAddress": "0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409", "sellerNKNAddress":"3dc6a2aecd4d341425d1d4a82f1ae5ab199eb89d18530f34bbe7a9ad04c53c13", "paymentTransactionID":"0x5dd4039c32F6EEF427D6F67600D8920c9631D59D"}'
```

### /buy
`/buy` provides an interface for purchasing an open order. It expects an HTTP Post request containing the following JSON schema:


| Key      | Description | 
| ----------- | ----------- |
| txid      | A Transaction ID for the order in question.     |
| buyerShippingAddress      | An address on the `tradeAsset` network that the buyer wishes to recieve payment on.    |
| paymentTransactionID      |  The Transaction ID proving that 1 MO has been burnt into the `paygate` contract.   |
| buyerNKNAddress      | The public NKN address the buyers's `tea` client is listening on. (Generated by `tea`)      |



Example curl request:
```cmd 
curl -v "http://localhost:45005/buy" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"txid":"0x1", "buyerShippingAddress":"0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409","buyerNKNAddress":"53e7f9da8201f7bd951be6116250ce9bfcc619e5c7429f169225a8ca3fd477de","paymentTransactionID":"0xb1306f77a428f99a01c888d172fc220805d30cfd46185f688eaf768eb1698d61","tradeAsset":"mineonlium"}'
```

### /listorders
`/listorders` provides an interface for listing the avalible orders. It expects an HTTP GET request. 

Example curl request:
```cmd 
curl -v "http://localhost:45005/listorders" 
```



### /fetchopenorderbynkn

```cmd
curl -v "http://localhost:8080/fetchopenorderbynkn" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"nknAddress":"74e67b7a554d91e4ee93d0c6a90b611fb1b0f1c13dc2116b5b69701a56d3e0a6"}'
```


## Building locally
### Required enviorment variables to run the backend adapter locally

```
export CELO_RPC_1=https://celo-alfajores.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export CELO_RPC_2=https://celo-alfajores.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export NEAR_RPC_1=https://near-testnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export NEAR_RPC_2=https://near-testnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export PARTY_CHAIN_1="http://172.104.194.36:8545"
export PARTY_CHAIN_2="http://172.104.194.36:8545"
export BTC_RPC_1="https://test.com"
export BTC_RPC_2="https://test.com"
export AVALANCE_RPC_1="https://avalanche-mainnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export AVALANCE_RPC_2="https://avalanche-mainnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export ETH_RPC_1="https://goerli.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export ETH_RPC_2="https://goerli.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export POLY_RPC_1="https://polygon-mumbai.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export POLY_RPC_2="https://polygon-mumbai.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export SOL_RPC_1=https://api.mainnet-beta.solana.com
export SOL_RPC_2=https://api.mainnet-beta.solana.com
export KAS_RPC_1=192.168.50.12:16110
export KAS_RPC_2=192.168.50.12:16110
export RXD_RPC_1=192.168.50.8:7332
export RXD_RPC_2=192.168.50.8:7332
export LTC_RPC_1=localhost:8332
export LTC_RPC_2=localhost:8332
export OCT_RPC_1=https://rpc.octa.space/
export OCT_RPC_2=https://rpc.octa.space/
export ETHONE_RPC_1=http://rpcetherone.dgir.fr
export ETHONE_RPC_2=http://rpcetherone.dgir.fr
export BLOCK_EXPLORER=https://tea.mining4people.com
export K_SINK=http://localhost:8082
export DLS=http://sockeye:8080
export KASPA_INTERFACE=http://localhost:8888
export REDIS_ADDRESS=192.168.50.7:6379
export REDIS_PASSWORD=""
export REDIS_DB=0
export DEV=true
export WATCH=true
export PRIVATE_KEY=
export NO_PARTY_FEE_ADDRESSES=0x5dd4039c32F6EEF427D6F67600D8920c9631D59D
export EXCHANGE_SERVER_ID=0x123
```


kubernetes services

```
export CELO_RPC_1=https://celo-alfajores.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export CELO_RPC_2=https://celo-alfajores.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export NEAR_RPC_1=https://near-testnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export NEAR_RPC_2=https://near-testnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e
export PARTY_CHAIN_1="http://172.104.194.36:8545"
export PARTY_CHAIN_2="http://172.104.194.36:8545"
export BTC_RPC_1="https://test.com"
export BTC_RPC_2="https://test.com"
export AVALANCE_RPC_1="https://avalanche-mainnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export AVALANCE_RPC_2="https://avalanche-mainnet.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export ETH_RPC_1="https://goerli.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export ETH_RPC_2="https://goerli.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export POLY_RPC_1="https://polygon-mumbai.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export POLY_RPC_2="https://polygon-mumbai.infura.io/v3/61979797a8bb4bfe9dddd4ff9675db7e"
export SOL_RPC_1=https://api.mainnet-beta.solana.com
export SOL_RPC_2=https://api.mainnet-beta.solana.com
export KAS_RPC_1=http://test
export KAS_RPC_2=http://test
export RXD_RPC_1=192.168.50.8:7332
export RXD_RPC_2=192.168.50.8:7332
export KAS_RPC_1=192.168.50.12:16110 
export KAS_RPC_2=192.168.50.12:16110 
export LTC_RPC_1=192.168.50.10:19332
export LTC_RPC_2=192.168.50.10:19332
export OCT_RPC_1=https://rpc.octa.space/
export OCT_RPC_2=https://rpc.octa.space/
export ETHONE_RPC_1=http://rpcetherone.dgir.fr
export ETHONE_RPC_2=http://rpcetherone.dgir.fr
export BLOCK_EXPLORER=https://www.partyexplorer.co/
export K_SINK=http://localhost:8082
export DLS=http://sockeye:8080
export KASPA_INTERFACE=http://localhost:8888
export REDIS_ADDRESS=192.168.50.7:6379
export REDIS_PASSWORD=""
export REDIS_DB=0
export DEV=true
export WATCH=true
export PRIVATE_KEY=
export NO_PARTY_FEE_ADDRESSES=0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e
export EXCHANGE_SERVER_ID=0x123
```


after exporting all that bullshit above.. 

```
cd cmd 
go run . 
```

# On chain
curl -v "http://0.0.0.0:8081/sell" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"octa","amount": 10000 ,"tradeAsset":"grams","price":10000, "txid":"122", "sellerShippingAddress": "0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e", "sellerNKNAddress":"3dc6a2aecd4d341425d1d4a82f1ae5ab199eb89d18530f34bbe7a9ad04c53c13","onChain":true}'

curl -v "http://0.0.0.0:8080/listorders" 

curl -v "http://localhost:8080/buy" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"txid":"12", "buyerShippingAddress":"0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e","onChain":true}'



# Off chain
curl -v "http://192.168.50.5:8080/sell" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"grams","amount": 10000 ,"tradeAsset":"grams","price":10000,  "txid":"32123122322121212", "sellerShippingAddress": "0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409", "sellerNKNAddress":"27a39e5473d62dc372fff7118b8774a661a4250e9e115eb6ec7361a9121c86e7", "paymentTransactionID":"0x5dd4039c32F6EEF427D6F67600D8920c9631D59D"}'

curl -v "http://localhost:8080/buy" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"txid":"e74b212c-0874-42cc-ad8a-5ffa98ae710d", "buyerShippingAddress":"0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409","buyerNKNAddress":"a93541e73808213c48dd624a10cf5d0f2cc5d51033acc4b1f9b5426c295c97eb","paymentTransactionID":"0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409"}'




curl -v "http://0.0.0.0:8080/sell" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"mineonlium","amount": 10000 ,"tradeAsset":"ANY","price":1000,  "txid":"32123122322121212", "sellerShippingAddress": "0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409", "sellerNKNAddress":"7d1fa6638f8bdd305ec28c94ecf78d304a8b96da4fd182e01614fefc4c957d0a", "paymentTransactionID":"0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e"}'

curl -v "http://localhost:8080/buy" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"txid":"32123122322121212", "buyerShippingAddress":"0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409","buyerNKNAddress":"7d1fa6638f8bdd305ec28c94ecf78d304a8b96da4fd182e01614fefc4c957d0a","paymentTransactionID":"0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e"}'


curl -v "https://teaparty-adams.ngrok.io/closeMarketOrder" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"orderID" : "7d1e95e8-beb6-40e4-a16c-848ee565d20c"}'

# Assisted Sell Order

curl -v "http://38.109.255.242:8080/assistedSell" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"grams","amount": 10000 ,"tradeAsset":"grams","price":10000,"sellerShippingAddress": "0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e","onChain":true,"assisted":true}'

curl -v "http://38.109.255.242:8080/listorders" 


curl -v "http://38.109.255.242:8080/buy" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"txid":"c52bd617-d590-4f09-acd5-581a6332c518", "buyerShippingAddress":"0x9cA67FFE69698d963A393E9338aD3BcfD2CEa02e","onChain":true}'



#TESTING

curl 'http://localhost:8081/sell' \
  -H 'Accept: application/json, text/plain, */*' \
  -H 'Accept-Language: en-US,en;q=0.9,es-US;q=0.8,es;q=0.7' \
  -H 'Connection: keep-alive' \
  -H 'Content-Type: application/json' \
  -H 'Origin: http://localhost:8081' \
  -H 'Referer: http://localhost:8081/' \
  -H 'Sec-Fetch-Dest: empty' \
  -H 'Sec-Fetch-Mode: cors' \
  -H 'Sec-Fetch-Site: same-origin' \
  -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36' \
  -H 'sec-ch-ua: "Google Chrome";v="111", "Not(A:Brand";v="8", "Chromium";v="111"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "Linux"' \
  --data-raw '{"tradeAsset":"radiant","amount":1000000000000000000,"currency":"polygon","price":2000000000000000000,"locked":false,"sellerShippingAddress":"x","sellerNKNAddress":"a93541e73808213c48dd624a10cf5d0f2cc5d51033acc4b1f9b5426c295c97eb","paymentTransactionID":"0x5dd4039c32F6EEF427D6F67600D8920c9631D59D","refundAddress":"a","private":false}' \
  --compressed


  ## Sell nft

curl -v "http://192.168.50.5:8080/sell" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"miningGame", "nftID":4,"amount": 10000 ,"tradeAsset":"grams","price":10000,  "txid":"1", "sellerShippingAddress": "0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409", "sellerNKNAddress":"e6fa35bc8bc26f6f8bea23a43eaecbd0bc49332b4fa8e9170aedc5598515bfd4", "paymentTransactionID":"0x5dd4039c32F6EEF427D6F67600D8920c9631D59D"}'


curl -v "http://192.168.50.5:8080/listorders" 

curl -v "http://192.168.50.5:8080/buy" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"txid":"1", "buyerShippingAddress":"0x53d7818dA5679Ffb3F20FE86ae871D1F691ff409","buyerNKNAddress":"e6fa35bc8bc26f6f8bea23a43eaecbd0bc49332b4fa8e9170aedc5598515bfd4","paymentTransactionID":"0x5dd4039c32F6EEF427D6F67600D8920c9631D59D"}'



  ## Query metrics
curl -v "http://192.168.50.5:8080/queryAllMetrics" 


## requestBridge

### GRAMS -> OCTA

curl -v "http://38.109.255.242:8080/requestBridge" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"grams","fromChain":"grams", "amount": 10000, "bridgeTo":"octa","shippingAddress":"0x5bbfa5724260Cb175cB39b24802A04c3bfe72eb3"}'

curl -v "http://38.109.255.242:8080/requestBridge" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"wgrams","fromChain":"octa", "amount": 10000, "bridgeTo":"grams","shippingAddress":"0x5bbfa5724260Cb175cB39b24802A04c3bfe72eb3"}'
  
### OCTA -> GRAMS

curl -v "http://38.109.255.242:8080/requestBridge" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"octa","fromChain":"octa", "amount": 10000, "bridgeTo":"grams","shippingAddress":"0x5bbfa5724260Cb175cB39b24802A04c3bfe72eb3"}'

curl -v "http://38.109.255.242:8080/requestBridge" \
       -X POST \
       -H "Content-Type: application/json" \
       -d '{"currency":"wocta","fromChain":"grams", "amount": 10000, "bridgeTo":"octa","shippingAddress":"0x5bbfa5724260Cb175cB39b24802A04c3bfe72eb3"}'